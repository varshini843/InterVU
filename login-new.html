<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>InterVU - Login</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #e4e8eb 100%);
      color: #333;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    nav.navbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #fff;
      padding: 1rem 2rem;
      box-shadow: 0 4px 10px rgba(0,0,0,0.06);
      user-select: none;
    }
    .logo {
      font-size: 1.8rem;
      font-weight: 600;
      color: #ff4d6d;
    }
    .nav-right a {
      margin-left: 1.5rem;
      font-weight: 500;
      color: #555;
      text-decoration: none;
      transition: color 0.3s ease;
    }
    .nav-right a:hover {
      color: #ff4d6d;
    }
    main {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 2rem;
    }
    .login-container {
      background: white;
      padding: 2.5rem 3rem;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
      max-width: 400px;
      width: 100%;
      text-align: center;
      animation: fadeInUp 0.6s ease forwards;
    }
    .login-container h2 {
      color: #ff4d6d;
      margin-bottom: 1.5rem;
      font-weight: 600;
    }
    .form-group {
      margin-bottom: 1.2rem;
      text-align: left;
    }
    label {
      display: block;
      text-align: left;
      margin-bottom: 0.3rem;
      font-weight: 600;
      color: #555;
      font-size: 0.95rem;
    }
    .input-group {
      position: relative;
    }
    .input-icon {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: #aaa;
    }
    input[type="email"],
    input[type="password"] {
      width: 100%;
      padding: 0.75rem 1rem 0.75rem 2.5rem;
      border: 1px solid #ddd;
      border-radius: 10px;
      font-size: 1rem;
      outline: none;
      transition: all 0.3s ease;
      box-sizing: border-box;
    }
    input[type="email"]:focus,
    input[type="password"]:focus {
      border-color: #ff4d6d;
      box-shadow: 0 0 0 3px rgba(255, 77, 109, 0.15);
    }
    .validation-icon {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
    }
    .validation-message {
      font-size: 0.8rem;
      color: #ff4d6d;
      margin-top: 0.3rem;
      min-height: 1rem;
    }
    .remember-forgot {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      font-size: 0.9rem;
    }
    .remember-me {
      display: flex;
      align-items: center;
    }
    .remember-me input {
      margin-right: 0.5rem;
    }
    .forgot-password {
      color: #ff4d6d;
      text-decoration: none;
      transition: color 0.3s ease;
    }
    .forgot-password:hover {
      color: #e63b5f;
      text-decoration: underline;
    }
    button {
      background-color: #ff4d6d;
      color: white;
      border: none;
      padding: 0.85rem 1.5rem;
      font-size: 1.1rem;
      border-radius: 10px;
      cursor: pointer;
      width: 100%;
      transition: all 0.3s ease;
      font-weight: 500;
      position: relative;
      overflow: hidden;
    }
    button:hover {
      background-color: #e63b5f;
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(230, 59, 95, 0.3);
    }
    button:active {
      transform: translateY(0);
    }
    button .spinner {
      display: none;
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
    }
    button.loading {
      color: transparent;
    }
    button.loading .spinner {
      display: block;
      color: white;
    }
    .register-link {
      margin-top: 1.5rem;
      font-size: 0.95rem;
      color: #666;
    }
    .register-link a {
      color: #ff4d6d;
      font-weight: 600;
      text-decoration: none;
      margin-left: 0.3rem;
      transition: color 0.3s ease;
    }
    .register-link a:hover {
      color: #e63b5f;
    }
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(40px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .spinner {
      animation: spin 1s linear infinite;
    }
    @media (max-width: 450px) {
      .login-container {
        padding: 2rem 1.5rem;
      }
    }
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      background: white;
      color: #333;
      padding: 1rem 1.5rem;
      border-radius: 8px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.15);
      display: flex;
      align-items: flex-start;
      gap: 10px;
      z-index: 1000;
      transition: all 0.3s ease;
      opacity: 0;
      transform: translateY(-20px);
      max-width: 400px;
      min-width: 300px;
      word-wrap: break-word;
      cursor: pointer;
    }
    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }
    .toast.success {
      border-left: 4px solid #4CAF50;
    }
    .toast.error {
      border-left: 4px solid #f44336;
    }
    .toast.warning {
      border-left: 4px solid #ff9800;
    }
    .toast-icon {
      font-size: 1.2rem;
      margin-top: 3px;
    }
    .toast.success .toast-icon {
      color: #4CAF50;
    }
    .toast.error .toast-icon {
      color: #f44336;
    }
    .toast.warning .toast-icon {
      color: #ff9800;
    }
    .toast::after {
      content: "Ã—";
      position: absolute;
      top: 8px;
      right: 12px;
      font-size: 16px;
      color: #999;
      opacity: 0.7;
    }
    .toast:hover::after {
      opacity: 1;
    }
    .email-status {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9rem;
      margin-top: 5px;
      padding: 8px 12px;
      border-radius: 6px;
      background-color: #f5f5f5;
    }
    .email-status.valid {
      background-color: rgba(76, 175, 80, 0.1);
      color: #2e7d32;
    }
    .email-status.invalid {
      background-color: rgba(244, 67, 54, 0.1);
      color: #c62828;
    }
    .email-status.checking {
      background-color: rgba(255, 152, 0, 0.1);
      color: #ef6c00;
    }
  </style>
</head>
<body>

  <nav class="navbar">
    <div class="logo">InterVU</div>
    <div class="nav-right">
      <a href="index.html">Home</a>
      <a href="login-new.html">Login</a>
      <a href="register-new.html">Register</a>
    </div>
  </nav>

  <main>
    <div class="login-container">
      <h2>Welcome Back</h2>
      <form id="loginForm" novalidate>
        <div class="form-group">
          <label for="email">Email Address</label>
          <div class="input-group">
            <i class="input-icon fas fa-envelope"></i>
            <input type="email" id="email" placeholder="you@example.com" required />
            <div class="validation-icon" id="emailValidationIcon"></div>
          </div>
          <div class="validation-message" id="emailValidationMessage"></div>
          <div id="emailStatusContainer" style="display: none;"></div>
        </div>

        <div class="form-group">
          <label for="password">Password</label>
          <div class="input-group">
            <i class="input-icon fas fa-lock"></i>
            <input type="password" id="password" placeholder="Enter your password" required />
            <div class="validation-icon" id="passwordToggle">
              <i class="fas fa-eye-slash" style="cursor: pointer; color: #aaa;"></i>
            </div>
          </div>
        </div>

        <div class="remember-forgot">
          <div class="remember-me">
            <input type="checkbox" id="remember" />
            <label for="remember" style="margin-bottom: 0;">Remember me</label>
          </div>
          <a href="#" class="forgot-password">Forgot Password?</a>
        </div>

        <button type="submit" id="loginButton">
          Login
          <i class="spinner fas fa-circle-notch"></i>
        </button>
      </form>

      <p class="register-link">
        Don't have an account?
        <a href="register-new.html">Register here</a>
      </p>
    </div>
  </main>

  <div id="toast" class="toast">
    <i class="toast-icon fas"></i>
    <span id="toastMessage"></span>
  </div>

  <script>
    const form = document.getElementById('loginForm');
    const loginButton = document.getElementById('loginButton');
    const passwordToggle = document.getElementById('passwordToggle');
    const passwordInput = document.getElementById('password');
    const toast = document.getElementById('toast');
    const toastMessage = document.getElementById('toastMessage');
    const emailInput = document.getElementById('email');
    const emailValidationIcon = document.getElementById('emailValidationIcon');
    const emailValidationMessage = document.getElementById('emailValidationMessage');
    const emailStatusContainer = document.getElementById('emailStatusContainer');

    // Toggle password visibility
    passwordToggle.addEventListener('click', function() {
      const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
      passwordInput.setAttribute('type', type);
      
      // Toggle eye icon
      const icon = passwordToggle.querySelector('i');
      icon.classList.toggle('fa-eye');
      icon.classList.toggle('fa-eye-slash');
    });

    // Show toast notification
    function showToast(message, type = 'error', duration = 5000) {
      toast.className = 'toast show ' + type;
      toastMessage.textContent = message;
      
      const icon = toast.querySelector('.toast-icon');
      icon.className = 'toast-icon fas';
      
      if (type === 'success') {
        icon.classList.add('fa-check-circle');
      } else if (type === 'error') {
        icon.classList.add('fa-exclamation-circle');
      } else if (type === 'warning') {
        icon.classList.add('fa-exclamation-triangle');
      }
      
      // Clear any existing timeout
      if (window.toastTimeout) {
        clearTimeout(window.toastTimeout);
      }
      
      // Set new timeout
      window.toastTimeout = setTimeout(() => {
        toast.classList.remove('show');
      }, duration);
      
      // Add click to dismiss
      toast.onclick = function() {
        toast.classList.remove('show');
        if (window.toastTimeout) {
          clearTimeout(window.toastTimeout);
        }
      };
    }

    // Abstract API key for email verification
    const ABSTRACT_API_KEY = 'ac9c597b644a44ddbfd0eb1692e05851'; // Your actual API key

    // Email validation with Abstract API
    async function validateEmail(email) {
      // Basic format check
      const basicFormatValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
      if (!basicFormatValid) {
        return { 
          valid: false, 
          message: 'Email format is invalid. Please include @ and domain.',
          details: null
        };
      }
      
      try {
        // Show checking status
        showEmailStatus('checking', 'Verifying email...');
        
        // Call the Abstract API
        const response = await fetch(`https://emailvalidation.abstractapi.com/v1/?api_key=${ABSTRACT_API_KEY}&email=${encodeURIComponent(email)}`);
        
        if (!response.ok) {
          throw new Error(`API request failed with status ${response.status}`);
        }
        
        const data = await response.json();
        console.log('API Response:', data); // Log the response for debugging
        
        // Check if the email is valid and deliverable
        if (!data.is_valid_format.value) {
          showEmailStatus('invalid', 'Invalid email format');
          return { 
            valid: false, 
            message: 'Email format is invalid.',
            details: data
          };
        }
        
        if (data.is_disposable_email.value) {
          showEmailStatus('invalid', 'Disposable emails are not allowed');
          return { 
            valid: false, 
            message: 'Please use a permanent email address. Disposable emails are not allowed.',
            details: data
          };
        }
        
        if (!data.is_mx_found.value) {
          showEmailStatus('invalid', 'This domain cannot receive emails');
          return { 
            valid: false, 
            message: 'This email domain cannot receive emails.',
            details: data
          };
        }
        
        // Check deliverability score
        if (data.deliverability === 'UNDELIVERABLE') {
          showEmailStatus('invalid', 'Email appears to be undeliverable');
          return { 
            valid: false, 
            message: 'This email appears to be undeliverable.',
            details: data
          };
        }
        
        // If we get here, the email is valid
        showEmailStatus('valid', 'Email verified successfully');
        return { 
          valid: true, 
          message: 'Email verified successfully',
          details: data
        };
      } catch (error) {
        console.error('Email verification error:', error);
        
        // Hide the status on error
        emailStatusContainer.style.display = 'none';
        
        // Return basic validation result
        return { 
          valid: basicFormatValid, 
          message: basicFormatValid ? 'Email format is valid' : 'Email format is invalid',
          details: null
        };
      }
    }
    
    // Show email validation status
    function showEmailStatus(status, message) {
      emailStatusContainer.style.display = 'block';
      
      let icon = '';
      if (status === 'valid') {
        icon = '<i class="fas fa-check-circle"></i>';
      } else if (status === 'invalid') {
        icon = '<i class="fas fa-times-circle"></i>';
      } else if (status === 'checking') {
        icon = '<i class="fas fa-spinner fa-spin"></i>';
      }
      
      emailStatusContainer.innerHTML = `
        <div class="email-status ${status}">
          ${icon} ${message}
        </div>
      `;
    }

    // Real-time email validation
    let emailValidationTimeout;
    
    emailInput.addEventListener('input', function() {
      const email = this.value.trim();
      
      // Clear previous timeout
      clearTimeout(emailValidationTimeout);
      
      if (!email) {
        emailValidationIcon.innerHTML = '';
        emailValidationMessage.textContent = '';
        emailStatusContainer.style.display = 'none';
        return;
      }
      
      // Basic format check for immediate feedback
      const basicFormatValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
      
      if (!basicFormatValid) {
        emailValidationIcon.innerHTML = '<i class="fas fa-times-circle" style="color: #f44336;"></i>';
        emailValidationMessage.textContent = 'Email format is invalid';
        emailStatusContainer.style.display = 'none';
        return;
      }
      
      // Set a delay to avoid validating on every keystroke
      emailValidationTimeout = setTimeout(async () => {
        // Show loading indicator
        emailValidationIcon.innerHTML = '<i class="fas fa-spinner fa-spin" style="color: #ff9800;"></i>';
        
        // Validate email with API
        const validation = await validateEmail(email);
        
        if (validation.valid) {
          // Valid email
          emailValidationIcon.innerHTML = '<i class="fas fa-check-circle" style="color: #4CAF50;"></i>';
          emailValidationMessage.textContent = '';
        } else {
          // Invalid email
          emailValidationIcon.innerHTML = '<i class="fas fa-exclamation-circle" style="color: #ff4d6d;"></i>';
          emailValidationMessage.textContent = validation.message;
        }
      }, 800);
    });

    // Form submission handler
    form.addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const email = emailInput.value.trim();
      const password = passwordInput.value;
      
      // Show loading state
      loginButton.classList.add('loading');
      
      if (!email) {
        showToast('Please enter your email address');
        loginButton.classList.remove('loading');
        emailInput.focus();
        return;
      }
      
      if (!password) {
        showToast('Please enter your password');
        loginButton.classList.remove('loading');
        passwordInput.focus();
        return;
      }
      
      // Validate email format
      const basicFormatValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
      if (!basicFormatValid) {
        showToast('Please enter a valid email address');
        loginButton.classList.remove('loading');
        emailInput.focus();
        return;
      }
      
      // Basic email validation is sufficient for login
      // We'll keep the real-time validation but not block login if the API validation fails
      // This allows users to log in even if the validation API is temporarily unavailable
      
      // Simulate API call to login
      setTimeout(() => {
        // Get users from localStorage
        const users = JSON.parse(localStorage.getItem('intervuUsers')) || [];
        
        // Find user with matching email
        const user = users.find(u => u.email.toLowerCase() === email.toLowerCase());
        
        if (!user) {
          showToast('No account found with this email address');
          loginButton.classList.remove('loading');
          return;
        }
        
        // Check password
        if (user.password !== password) {
          showToast('Incorrect password');
          loginButton.classList.remove('loading');
          return;
        }
        
        // Login successful
        showToast('Login successful!', 'success');
        
        // Store logged in user
        localStorage.setItem('currentUser', JSON.stringify({
          fullname: user.fullname,
          email: user.email,
          loggedInAt: new Date().toISOString()
        }));
        
        // Redirect to dashboard or home page
        setTimeout(() => {
          window.location.href = 'index.html';
        }, 1500);
      }, 1500);
    });
  </script>

</body>
</html>