<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>InterVU - Register</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #e4e8eb 100%);
      color: #333;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    nav.navbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #fff;
      padding: 1rem 2rem;
      box-shadow: 0 4px 10px rgba(0,0,0,0.06);
      user-select: none;
    }
    .logo {
      font-size: 1.8rem;
      font-weight: 600;
      color: #ff4d6d;
    }
    .nav-right a {
      margin-left: 1.5rem;
      font-weight: 500;
      color: #555;
      text-decoration: none;
      transition: color 0.3s ease;
    }
    .nav-right a:hover {
      color: #ff4d6d;
    }
    main {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 2rem;
    }
    .register-container {
      background: white;
      padding: 2.5rem 3rem;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
      max-width: 450px;
      width: 100%;
      text-align: center;
      animation: fadeInUp 0.6s ease forwards;
    }
    .register-container h2 {
      color: #ff4d6d;
      margin-bottom: 1.5rem;
      font-weight: 600;
    }
    .form-group {
      margin-bottom: 1.2rem;
      text-align: left;
    }
    label {
      display: block;
      text-align: left;
      margin-bottom: 0.3rem;
      font-weight: 600;
      color: #555;
      font-size: 0.95rem;
    }
    .input-group {
      position: relative;
    }
    .input-icon {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: #aaa;
    }
    input[type="text"],
    input[type="email"],
    input[type="password"] {
      width: 100%;
      padding: 0.75rem 1rem 0.75rem 2.5rem;
      border: 1px solid #ddd;
      border-radius: 10px;
      font-size: 1rem;
      outline: none;
      transition: all 0.3s ease;
      box-sizing: border-box;
    }
    input[type="text"]:focus,
    input[type="email"]:focus,
    input[type="password"]:focus {
      border-color: #ff4d6d;
      box-shadow: 0 0 0 3px rgba(255, 77, 109, 0.15);
    }
    .validation-icon {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
    }
    .validation-message {
      font-size: 0.8rem;
      color: #ff4d6d;
      margin-top: 0.3rem;
      min-height: 1rem;
    }
    .password-strength {
      height: 5px;
      background-color: #eee;
      border-radius: 5px;
      margin-top: 0.5rem;
      overflow: hidden;
    }
    .password-strength-meter {
      height: 100%;
      width: 0;
      transition: width 0.3s ease, background-color 0.3s ease;
    }
    .password-strength-text {
      font-size: 0.8rem;
      margin-top: 0.3rem;
      text-align: right;
    }
    .password-requirements {
      margin-top: 0.5rem;
      font-size: 0.8rem;
      color: #666;
    }
    .requirement {
      display: flex;
      align-items: center;
      margin-bottom: 0.2rem;
    }
    .requirement i {
      margin-right: 0.5rem;
      font-size: 0.7rem;
    }
    .requirement.met i {
      color: #4CAF50;
    }
    .requirement.unmet i {
      color: #aaa;
    }
    button {
      background-color: #ff4d6d;
      color: white;
      border: none;
      padding: 0.85rem 1.5rem;
      font-size: 1.1rem;
      border-radius: 10px;
      cursor: pointer;
      width: 100%;
      transition: all 0.3s ease;
      font-weight: 500;
      margin-top: 0.5rem;
      position: relative;
      overflow: hidden;
    }
    button:hover {
      background-color: #e63b5f;
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(230, 59, 95, 0.3);
    }
    button:active {
      transform: translateY(0);
    }
    button .spinner {
      display: none;
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
    }
    button.loading {
      color: transparent;
    }
    button.loading .spinner {
      display: block;
      color: white;
    }
    .login-link {
      margin-top: 1.5rem;
      font-size: 0.95rem;
      color: #666;
    }
    .login-link a {
      color: #ff4d6d;
      font-weight: 600;
      text-decoration: none;
      margin-left: 0.3rem;
      transition: color 0.3s ease;
    }
    .login-link a:hover {
      color: #e63b5f;
    }
    .terms {
      font-size: 0.8rem;
      color: #777;
      margin-top: 1rem;
      line-height: 1.4;
    }
    .terms a {
      color: #ff4d6d;
      text-decoration: none;
    }
    .terms a:hover {
      text-decoration: underline;
    }
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(40px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .spinner {
      animation: spin 1s linear infinite;
    }
    @media (max-width: 500px) {
      .register-container {
        padding: 2rem 1.5rem;
      }
    }
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      background: white;
      color: #333;
      padding: 1rem 1.5rem;
      border-radius: 8px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.15);
      display: flex;
      align-items: flex-start;
      gap: 10px;
      z-index: 1000;
      transition: all 0.3s ease;
      opacity: 0;
      transform: translateY(-20px);
      max-width: 400px;
      min-width: 300px;
      word-wrap: break-word;
      cursor: pointer;
    }
    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }
    .toast.success {
      border-left: 4px solid #4CAF50;
    }
    .toast.error {
      border-left: 4px solid #f44336;
    }
    .toast.warning {
      border-left: 4px solid #ff9800;
    }
    .toast-icon {
      font-size: 1.2rem;
      margin-top: 3px;
    }
    .toast.success .toast-icon {
      color: #4CAF50;
    }
    .toast.error .toast-icon {
      color: #f44336;
    }
    .toast.warning .toast-icon {
      color: #ff9800;
    }
    .toast::after {
      content: "Ã—";
      position: absolute;
      top: 8px;
      right: 12px;
      font-size: 16px;
      color: #999;
      opacity: 0.7;
    }
    .toast:hover::after {
      opacity: 1;
    }
    #verificationSection {
      background-color: #f9f9f9;
      border-radius: 10px;
      padding: 15px;
      border: 1px solid #eee;
      margin-top: 10px;
    }
    .verification-timer {
      font-size: 0.85rem;
      color: #666;
      margin-top: 10px;
      text-align: center;
    }
    .verification-timer span {
      font-weight: 600;
      color: #ff4d6d;
    }
    .email-status {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9rem;
      margin-top: 5px;
      padding: 8px 12px;
      border-radius: 6px;
      background-color: #f5f5f5;
    }
    .email-status.valid {
      background-color: rgba(76, 175, 80, 0.1);
      color: #2e7d32;
    }
    .email-status.invalid {
      background-color: rgba(244, 67, 54, 0.1);
      color: #c62828;
    }
    .email-status.checking {
      background-color: rgba(255, 152, 0, 0.1);
      color: #ef6c00;
    }
  </style>
</head>
<body>

  <nav class="navbar">
    <div class="logo">InterVU</div>
    <div class="nav-right">
      <a href="index.html">Home</a>
      <a href="login-new.html">Login</a>
      <a href="register-new.html">Register</a>
    </div>
  </nav>

  <main>
    <div class="register-container">
      <h2>Create Your Account</h2>
      <form id="registerForm" novalidate>
        <div class="form-group">
          <label for="fullname">Full Name</label>
          <div class="input-group">
            <i class="input-icon fas fa-user"></i>
            <input type="text" id="fullname" placeholder="Your full name" required />
          </div>
        </div>

        <div class="form-group">
          <label for="email">Email Address</label>
          <div class="input-group">
            <i class="input-icon fas fa-envelope"></i>
            <input type="email" id="email" placeholder="you@example.com" required />
            <div class="validation-icon" id="emailValidationIcon"></div>
          </div>
          <div class="validation-message" id="emailValidationMessage"></div>
          <div id="emailStatusContainer" style="display: none;"></div>
        </div>

        <div class="form-group">
          <label for="password">Password</label>
          <div class="input-group">
            <i class="input-icon fas fa-lock"></i>
            <input type="password" id="password" placeholder="Create a password" required minlength="8" />
            <div class="validation-icon" id="passwordToggle">
              <i class="fas fa-eye-slash" style="cursor: pointer; color: #aaa;"></i>
            </div>
          </div>
          <div class="password-strength">
            <div class="password-strength-meter" id="passwordStrengthMeter"></div>
          </div>
          <div class="password-strength-text" id="passwordStrengthText"></div>
          <div class="password-requirements">
            <div class="requirement" id="req-length"><i class="fas fa-circle"></i> At least 8 characters</div>
            <div class="requirement" id="req-uppercase"><i class="fas fa-circle"></i> At least 1 uppercase letter</div>
            <div class="requirement" id="req-lowercase"><i class="fas fa-circle"></i> At least 1 lowercase letter</div>
            <div class="requirement" id="req-number"><i class="fas fa-circle"></i> At least 1 number</div>
            <div class="requirement" id="req-special"><i class="fas fa-circle"></i> At least 1 special character</div>
          </div>
        </div>

        <div class="form-group">
          <label for="confirm-password">Confirm Password</label>
          <div class="input-group">
            <i class="input-icon fas fa-lock"></i>
            <input type="password" id="confirm-password" placeholder="Confirm your password" required minlength="8" />
            <div class="validation-icon" id="confirmPasswordIcon"></div>
          </div>
          <div class="validation-message" id="confirmPasswordMessage"></div>
        </div>

        <!-- Email verification section removed as requested -->

        <button type="submit" id="registerButton">
          Create Account
          <i class="spinner fas fa-circle-notch"></i>
        </button>

        <p class="terms">
          By creating an account, you agree to our <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a>
        </p>
      </form>

      <p class="login-link">
        Already have an account?
        <a href="login-new.html">Login here</a>
      </p>
    </div>
  </main>

  <div id="toast" class="toast">
    <i class="toast-icon fas"></i>
    <span id="toastMessage"></span>
  </div>

  <script>
    const form = document.getElementById('registerForm');
    const registerButton = document.getElementById('registerButton');
    const passwordToggle = document.getElementById('passwordToggle');
    const passwordInput = document.getElementById('password');
    const confirmPasswordInput = document.getElementById('confirm-password');
    const confirmPasswordIcon = document.getElementById('confirmPasswordIcon');
    const confirmPasswordMessage = document.getElementById('confirmPasswordMessage');
    const toast = document.getElementById('toast');
    const toastMessage = document.getElementById('toastMessage');
    const emailInput = document.getElementById('email');
    const emailValidationIcon = document.getElementById('emailValidationIcon');
    const emailValidationMessage = document.getElementById('emailValidationMessage');
    const emailStatusContainer = document.getElementById('emailStatusContainer');

    // Password strength elements
    const passwordStrengthMeter = document.getElementById('passwordStrengthMeter');
    const passwordStrengthText = document.getElementById('passwordStrengthText');
    const reqLength = document.getElementById('req-length');
    const reqUppercase = document.getElementById('req-uppercase');
    const reqLowercase = document.getElementById('req-lowercase');
    const reqNumber = document.getElementById('req-number');
    const reqSpecial = document.getElementById('req-special');

    // Toggle password visibility
    passwordToggle.addEventListener('click', function() {
      const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
      passwordInput.setAttribute('type', type);
      confirmPasswordInput.setAttribute('type', type);
      
      // Toggle eye icon
      const icon = passwordToggle.querySelector('i');
      icon.classList.toggle('fa-eye');
      icon.classList.toggle('fa-eye-slash');
    });

    // Show toast notification
    function showToast(message, type = 'error', duration = 5000) {
      toast.className = 'toast show ' + type;
      toastMessage.textContent = message;
      
      const icon = toast.querySelector('.toast-icon');
      icon.className = 'toast-icon fas';
      
      if (type === 'success') {
        icon.classList.add('fa-check-circle');
      } else if (type === 'error') {
        icon.classList.add('fa-exclamation-circle');
      } else if (type === 'warning') {
        icon.classList.add('fa-exclamation-triangle');
      }
      
      // Clear any existing timeout
      if (window.toastTimeout) {
        clearTimeout(window.toastTimeout);
      }
      
      // Set new timeout
      window.toastTimeout = setTimeout(() => {
        toast.classList.remove('show');
      }, duration);
      
      // Add click to dismiss
      toast.onclick = function() {
        toast.classList.remove('show');
        if (window.toastTimeout) {
          clearTimeout(window.toastTimeout);
        }
      };
    }

    // Password strength checker
    function checkPasswordStrength(password) {
      let strength = 0;
      let feedback = '';
      
      // Check requirements
      const hasLength = password.length >= 8;
      const hasUppercase = /[A-Z]/.test(password);
      const hasLowercase = /[a-z]/.test(password);
      const hasNumber = /[0-9]/.test(password);
      const hasSpecial = /[^A-Za-z0-9]/.test(password);
      
      // Update requirement indicators
      reqLength.className = hasLength ? 'requirement met' : 'requirement unmet';
      reqUppercase.className = hasUppercase ? 'requirement met' : 'requirement unmet';
      reqLowercase.className = hasLowercase ? 'requirement met' : 'requirement unmet';
      reqNumber.className = hasNumber ? 'requirement met' : 'requirement unmet';
      reqSpecial.className = hasSpecial ? 'requirement met' : 'requirement unmet';
      
      // Calculate strength
      if (hasLength) strength += 1;
      if (hasUppercase) strength += 1;
      if (hasLowercase) strength += 1;
      if (hasNumber) strength += 1;
      if (hasSpecial) strength += 1;
      
      // Update strength meter
      let percentage = (strength / 5) * 100;
      passwordStrengthMeter.style.width = percentage + '%';
      
      // Set color based on strength
      if (strength < 2) {
        passwordStrengthMeter.style.backgroundColor = '#f44336'; // Red
        feedback = 'Weak';
      } else if (strength < 4) {
        passwordStrengthMeter.style.backgroundColor = '#ff9800'; // Orange
        feedback = 'Moderate';
      } else {
        passwordStrengthMeter.style.backgroundColor = '#4CAF50'; // Green
        feedback = 'Strong';
      }
      
      // Update strength text
      passwordStrengthText.textContent = feedback;
      passwordStrengthText.style.color = passwordStrengthMeter.style.backgroundColor;
      
      return strength;
    }

    // Check if password is strong enough
    function isPasswordStrong(password) {
      const strength = checkPasswordStrength(password);
      return strength >= 3; // At least 3 out of 5 criteria
    }

    // Password input event
    passwordInput.addEventListener('input', function() {
      checkPasswordStrength(this.value);
      
      // Check if passwords match
      if (confirmPasswordInput.value) {
        if (this.value === confirmPasswordInput.value) {
          confirmPasswordIcon.innerHTML = '<i class="fas fa-check-circle" style="color: #4CAF50;"></i>';
          confirmPasswordMessage.textContent = '';
        } else {
          confirmPasswordIcon.innerHTML = '<i class="fas fa-times-circle" style="color: #f44336;"></i>';
          confirmPasswordMessage.textContent = 'Passwords do not match';
        }
      }
    });

    // Confirm password input event
    confirmPasswordInput.addEventListener('input', function() {
      if (this.value) {
        if (this.value === passwordInput.value) {
          confirmPasswordIcon.innerHTML = '<i class="fas fa-check-circle" style="color: #4CAF50;"></i>';
          confirmPasswordMessage.textContent = '';
        } else {
          confirmPasswordIcon.innerHTML = '<i class="fas fa-times-circle" style="color: #f44336;"></i>';
          confirmPasswordMessage.textContent = 'Passwords do not match';
        }
      } else {
        confirmPasswordIcon.innerHTML = '';
        confirmPasswordMessage.textContent = '';
      }
    });

    // Abstract API key for email verification
    const ABSTRACT_API_KEY = 'ac9c597b644a44ddbfd0eb1692e05851'; // Abstract API key for email verification

    // Email validation with Abstract API
    async function validateEmail(email) {
      // Basic format check
      const basicFormatValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
      if (!basicFormatValid) {
        return { 
          valid: false, 
          message: 'Email format is invalid. Please include @ and domain.',
          details: null
        };
      }
      
      try {
        // Show checking status
        showEmailStatus('checking', 'Verifying email...');
        
        // Call the Abstract API
        const response = await fetch(`https://emailvalidation.abstractapi.com/v1/?api_key=${ABSTRACT_API_KEY}&email=${encodeURIComponent(email)}`);
        
        if (!response.ok) {
          throw new Error(`API request failed with status ${response.status}`);
        }
        
        const data = await response.json();
        console.log('API Response:', data); // Log the response for debugging
        
        // Check if the email is valid and deliverable
        if (!data.is_valid_format.value) {
          showEmailStatus('invalid', 'Invalid email format');
          return { 
            valid: false, 
            message: 'Email format is invalid.',
            details: data
          };
        }
        
        if (data.is_disposable_email.value) {
          showEmailStatus('invalid', 'Disposable emails are not allowed');
          return { 
            valid: false, 
            message: 'Please use a permanent email address. Disposable emails are not allowed.',
            details: data
          };
        }
        
        if (!data.is_mx_found.value) {
          showEmailStatus('invalid', 'This domain cannot receive emails');
          return { 
            valid: false, 
            message: 'This email domain cannot receive emails.',
            details: data
          };
        }
        
        if (data.is_role_email.value) {
          showEmailStatus('invalid', 'Please use a personal email address');
          return { 
            valid: false, 
            message: 'Please use a personal email address, not a role-based one (like info@ or support@).',
            details: data
          };
        }
        
        // Check deliverability score - be more strict
        if (data.deliverability === 'UNDELIVERABLE' || data.deliverability === 'RISKY') {
          showEmailStatus('invalid', 'Email appears to be undeliverable or risky');
          return { 
            valid: false, 
            message: 'This email appears to be undeliverable or risky. Please use a valid email address.',
            details: data
          };
        }
        
        // Check quality score - require at least medium quality
        const qualityScore = parseFloat(data.quality_score);
        if (qualityScore < 0.5) {
          showEmailStatus('invalid', 'Email quality is too low');
          return { 
            valid: false, 
            message: 'This email address appears to be low quality. Please use a valid email address.',
            details: data
          };
        }
        
        // If we get here, the email is valid
        showEmailStatus('valid', 'Email verified successfully');
        return { 
          valid: true, 
          message: 'Email verified successfully',
          details: data
        };
      } catch (error) {
        console.error('Email verification error:', error);
        
        // Hide the status on error
        emailStatusContainer.style.display = 'none';
        
        // On API error, we should NOT allow registration to proceed with just basic validation
        // This ensures only verified emails can register
        return { 
          valid: false, 
          message: 'Email verification failed. Please try again later.',
          details: null
        };
      }
    }
    
    // Show email validation status
    function showEmailStatus(status, message) {
      emailStatusContainer.style.display = 'block';
      
      let icon = '';
      if (status === 'valid') {
        icon = '<i class="fas fa-check-circle"></i>';
      } else if (status === 'invalid') {
        icon = '<i class="fas fa-times-circle"></i>';
      } else if (status === 'checking') {
        icon = '<i class="fas fa-spinner fa-spin"></i>';
      }
      
      emailStatusContainer.innerHTML = `
        <div class="email-status ${status}">
          ${icon} ${message}
        </div>
      `;
    }

    // Real-time email validation
    let emailValidationTimeout;
    
    emailInput.addEventListener('input', function() {
      const email = this.value.trim();
      
      // Clear previous timeout
      clearTimeout(emailValidationTimeout);
      
      if (!email) {
        emailValidationIcon.innerHTML = '';
        emailValidationMessage.textContent = '';
        emailStatusContainer.style.display = 'none';
        return;
      }
      
      // Basic format check for immediate feedback
      const basicFormatValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
      
      if (!basicFormatValid) {
        emailValidationIcon.innerHTML = '<i class="fas fa-times-circle" style="color: #f44336;"></i>';
        emailValidationMessage.textContent = 'Email format is invalid';
        emailStatusContainer.style.display = 'none';
        return;
      }
      
      // Set a delay to avoid validating on every keystroke
      emailValidationTimeout = setTimeout(async () => {
        // Show loading indicator
        emailValidationIcon.innerHTML = '<i class="fas fa-spinner fa-spin" style="color: #ff9800;"></i>';
        
        // Validate email with API
        const validation = await validateEmail(email);
        
        if (validation.valid) {
          // Valid email
          emailValidationIcon.innerHTML = '<i class="fas fa-check-circle" style="color: #4CAF50;"></i>';
          emailValidationMessage.textContent = '';
        } else {
          // Invalid email
          emailValidationIcon.innerHTML = '<i class="fas fa-exclamation-circle" style="color: #ff4d6d;"></i>';
          emailValidationMessage.textContent = validation.message;
        }
      }, 800);
    });

    // Email verification removed as requested
    // Keeping only the real-time email validation

    // Form submission handler
    form.addEventListener('submit', async function (e) {
      e.preventDefault();

      const fullname = form.fullname.value.trim();
      const email = form.email.value.trim();
      const password = form.password.value;
      const confirmPassword = form['confirm-password'].value;

      // Show loading state
      registerButton.classList.add('loading');

      if (!fullname) {
        showToast('Please enter your full name');
        registerButton.classList.remove('loading');
        form.fullname.focus();
        return;
      }

      if (!email) {
        showToast('Please enter your email address');
        registerButton.classList.remove('loading');
        form.email.focus();
        return;
      }

      // Validate email with API - strict validation
      showToast('Verifying your email address...', 'warning');
      const emailValidation = await validateEmail(email);
      if (!emailValidation.valid) {
        showToast(emailValidation.message, 'error');
        registerButton.classList.remove('loading');
        form.email.focus();
        return;
      }
      
      // Additional check to ensure we have API validation results
      if (!emailValidation.details) {
        showToast('Email verification service is unavailable. Please try again later.', 'error');
        registerButton.classList.remove('loading');
        return;
      }

      // Check password strength
      const passwordStrength = checkPasswordStrength(password);
      if (passwordStrength < 3) {
        showToast('Please create a stronger password');
        registerButton.classList.remove('loading');
        form.password.focus();
        return;
      }

      if (password !== confirmPassword) {
        showToast('Passwords do not match');
        registerButton.classList.remove('loading');
        form['confirm-password'].focus();
        return;
      }

      // Check if email already registered
      const users = JSON.parse(localStorage.getItem('intervuUsers')) || [];
      if (users.some(u => u.email.toLowerCase() === email.toLowerCase())) {
        showToast('This email is already registered. Please login or use a different email.');
        registerButton.classList.remove('loading');
        form.email.focus();
        return;
      }

      try {
        // Save new user with verified email (since we've validated with Abstract API)
        const newUser = { 
          fullname, 
          email, 
          password,
          created: new Date().toISOString(),
          verified: true, // Email is verified through Abstract API
          emailVerified: true // Additional flag to indicate email verification
        };
        
        users.push(newUser);
        localStorage.setItem('intervuUsers', JSON.stringify(users));
        
        // Registration successful
        showToast('Registration successful! Your email has been verified.', 'success');
        
        // Redirect after a short delay
        setTimeout(() => {
          window.location.href = 'login-new.html';
        }, 2500);
      } catch (error) {
        console.error('Error during registration:', error);
        showToast('Registration failed. Please try again.', 'error');
        registerButton.classList.remove('loading');
      }
    });
  </script>

</body>
</html>
