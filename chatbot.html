<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>InterVU - AI Interview Chatbot</title>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <style>
    /* Reset & base */
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(to right, #fef9f9, #eef2f3);
      color: #333;
      scroll-behavior: smooth;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    a {
      text-decoration: none;
      color: inherit;
      cursor: pointer;
    }

    /* Navbar */
    nav.navbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #fff;
      padding: 1rem 2rem;
      box-shadow: 0 4px 10px rgba(0,0,0,0.06);
      position: relative;
      z-index: 100;
    }
    .logo {
      font-size: 1.8rem;
      font-weight: 600;
      color: #ff4d6d;
      user-select: none;
    }
    .nav-right {
      display: flex;
      align-items: center;
      gap: 1.7rem;
    }
    .nav-right a {
      font-weight: 500;
      color: #555;
      transition: color 0.3s ease;
    }
    .nav-right a:hover {
      color: #ff4d6d;
    }

    /* Main content */
    .main-container {
      max-width: 1200px;
      width: 100%;
      margin: 2rem auto;
      padding: 0 2rem;
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .page-title {
      text-align: center;
      margin-bottom: 2rem;
    }

    .page-title h1 {
      color: #ff4d6d;
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
    }

    .page-title p {
      color: #666;
      font-size: 1.1rem;
      max-width: 700px;
      margin: 0 auto;
    }

    /* Chatbot container */
    .chatbot-container {
      background: white;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      height: 70vh;
      flex: 1;
    }

    /* Chat header */
    .chat-header {
      background: #ff4d6d;
      color: white;
      padding: 1rem 1.5rem;
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .chat-header .avatar {
      width: 40px;
      height: 40px;
      background: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .chat-header .avatar i {
      color: #ff4d6d;
      font-size: 1.5rem;
    }

    .chat-header .info h2 {
      margin: 0;
      font-size: 1.2rem;
    }

    .chat-header .info p {
      margin: 0;
      font-size: 0.9rem;
      opacity: 0.9;
    }

    /* Chat messages */
    .chat-messages {
      flex: 1;
      padding: 1.5rem;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .message {
      max-width: 80%;
      padding: 1rem;
      border-radius: 15px;
      position: relative;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .message.bot {
      align-self: flex-start;
      background: #f0f0f0;
      border-bottom-left-radius: 5px;
    }

    .message.user {
      align-self: flex-end;
      background: #ff4d6d;
      color: white;
      border-bottom-right-radius: 5px;
    }

    .message p {
      margin: 0;
      line-height: 1.5;
    }

    .message .timestamp {
      font-size: 0.7rem;
      opacity: 0.7;
      margin-top: 0.5rem;
      text-align: right;
    }

    /* Typing indicator */
    .typing-indicator {
      display: none;
      align-self: flex-start;
      background: #f0f0f0;
      padding: 0.8rem 1rem;
      border-radius: 15px;
      border-bottom-left-radius: 5px;
      margin-top: 0.5rem;
    }

    .typing-indicator span {
      height: 8px;
      width: 8px;
      background: #888;
      display: inline-block;
      border-radius: 50%;
      margin: 0 1px;
      animation: typing 1.4s infinite both;
    }

    .typing-indicator span:nth-child(2) {
      animation-delay: 0.2s;
    }

    .typing-indicator span:nth-child(3) {
      animation-delay: 0.4s;
    }

    @keyframes typing {
      0% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
      100% { transform: translateY(0); }
    }

    /* Chat input */
    .chat-input {
      padding: 1rem;
      border-top: 1px solid #eee;
      display: flex;
      gap: 1rem;
    }

    .chat-input input {
      flex: 1;
      padding: 0.8rem 1.2rem;
      border: 1px solid #ddd;
      border-radius: 30px;
      font-family: 'Poppins', sans-serif;
      font-size: 1rem;
      outline: none;
      transition: border-color 0.3s;
    }

    .chat-input input:focus {
      border-color: #ff4d6d;
    }

    .chat-input button {
      background: #ff4d6d;
      color: white;
      border: none;
      border-radius: 50%;
      width: 45px;
      height: 45px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background 0.3s, transform 0.2s;
    }

    .chat-input button:hover {
      background: #e63b5f;
      transform: scale(1.05);
    }

    .chat-input button:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }

    .chat-input button i {
      font-size: 1.2rem;
    }

    /* Suggestions */
    .suggestions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: 1rem;
    }

    .suggestion {
      background: #f5f5f5;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: background 0.3s, transform 0.2s;
    }

    .suggestion:hover {
      background: #e0e0e0;
      transform: scale(1.05);
    }

    /* Footer */
    footer {
      text-align: center;
      padding: 1.5rem 2rem;
      background: #fff;
      color: #666;
      font-size: 0.9rem;
      user-select: none;
      border-top: 1px solid #eee;
      margin-top: auto;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .main-container {
        padding: 0 1rem;
        margin: 1rem auto;
      }

      .chatbot-container {
        height: 75vh;
      }

      .message {
        max-width: 90%;
      }

      .page-title h1 {
        font-size: 2rem;
      }

      .page-title p {
        font-size: 1rem;
      }
    }
  </style>
</head>
<body>

  <nav class="navbar">
    <div class="logo">InterVU</div>
    <div class="nav-right">
      <a href="index.html">Home</a>
     
      <a href="index.html#contact">Contact</a>
      <a href="login.html">Login</a>
    </div>
  </nav>

  <div class="main-container">
    <div class="page-title">
      <h1>AI Interview Assistant</h1>
      <p>Chat with our AI assistant to get instant answers to your interview questions, resume tips, and career advice.</p>
    </div>

    <div class="chatbot-container">
      <div class="chat-header">
        <div class="avatar">
          <i class="fas fa-robot"></i>
        </div>
        <div class="info">
          <h2>InterVU Assistant</h2>
          <p>Online and ready to help</p>
        </div>
      </div>

      <div class="chat-messages" id="chat-messages">
        <div class="message bot">
          <p>ðŸ‘‹ Hi there! I'm your InterVU AI Assistant. I can help you prepare for interviews, review your resume, or answer any career-related questions. How can I assist you today?</p>
          <div class="timestamp">Just now</div>
        </div>
      </div>

      <div class="typing-indicator" id="typing-indicator">
        <span></span>
        <span></span>
        <span></span>
      </div>

      <div class="chat-input">
        <input type="text" id="user-input" placeholder="Type your message here..." autocomplete="off">
        <button id="send-button" type="button">
          <i class="fas fa-paper-plane"></i>
        </button>
      </div>

      <div class="suggestions">
        <div class="suggestion">How to answer "Tell me about yourself"?</div>
        <div class="suggestion">Common interview questions</div>
        <div class="suggestion">Resume tips</div>
        <div class="suggestion">Salary negotiation advice</div>
      </div>
    </div>
  </div>

  <footer>
    &copy; 2025 InterVU. All rights reserved.
  </footer>

  <script src="config.js"></script>
  <script>
    // DOM Elements
    const chatMessages = document.getElementById('chat-messages');
    const userInput = document.getElementById('user-input');
    const sendButton = document.getElementById('send-button');
    const typingIndicator = document.getElementById('typing-indicator');
    const suggestions = document.querySelectorAll('.suggestion');

    // Initialize API key
    let API_KEY = null;
    
    // Function to initialize API key
    function initializeApiKey() {
      if (window.CONFIG && window.CONFIG.TOGETHER_API_KEY) {
        API_KEY = window.CONFIG.TOGETHER_API_KEY;
        console.log("Together API key initialized successfully");
      } else {
        console.warn("CONFIG not found or missing TOGETHER_API_KEY");
        // Try again in 1 second
        setTimeout(initializeApiKey, 1000);
      }
    }
    
    // Initialize API key
    initializeApiKey();
    
    // Check if user is logged in and update navbar
    document.addEventListener('DOMContentLoaded', function() {
      const currentUser = JSON.parse(localStorage.getItem('intervuCurrentUser'));
      const navRight = document.querySelector('.nav-right');
      
      if (currentUser && navRight) {
        // Replace login link with dashboard link if user is logged in
        const loginLink = navRight.querySelector('a[href="login.html"]');
        if (loginLink) {
          loginLink.href = 'dashboard-new.html';
          loginLink.textContent = 'Dashboard';
          
          // Add logout link
          const logoutLink = document.createElement('a');
          logoutLink.href = '#';
          logoutLink.textContent = 'Logout';
          logoutLink.addEventListener('click', function(e) {
            e.preventDefault();
            localStorage.removeItem('intervuCurrentUser');
            window.location.href = 'login.html';
          });
          navRight.appendChild(logoutLink);
        }
        
        // Initialize chat tracking
        initChatTracking(currentUser.email);
      }
    });
    
    // Chat activity tracking variables
    let chatActivityId = null;
    let userEmail = null;
    
    // Initialize chat tracking
    function initChatTracking(email) {
      userEmail = email;
      
      // Get user activity data
      let userData = JSON.parse(localStorage.getItem('intervuUserActivity_' + userEmail));
      
      if (!userData) {
        // Initialize if not exists
        userData = {
          interviews: [],
          resumes: [],
          chats: [],
          logins: []
        };
      }
      
      // Add new chat activity
      const now = new Date().getTime();
      chatActivityId = userData.chats.length + 1;
      
      userData.chats.push({
        id: chatActivityId,
        timestamp: now,
        duration: 0,
        messageCount: 0,
        details: {}
      });
      
      // Save updated data
      localStorage.setItem('intervuUserActivity_' + userEmail, JSON.stringify(userData));
      
      // Update duration periodically
      const durationInterval = setInterval(() => {
        if (!userEmail) {
          clearInterval(durationInterval);
          return;
        }
        
        let userData = JSON.parse(localStorage.getItem('intervuUserActivity_' + userEmail));
        
        if (!userData) {
          clearInterval(durationInterval);
          return;
        }
        
        const chat = userData.chats.find(c => c.id === chatActivityId);
        if (chat) {
          chat.duration = Math.floor((new Date().getTime() - chat.timestamp) / 60000); // minutes
          localStorage.setItem('intervuUserActivity_' + userEmail, JSON.stringify(userData));
        }
      }, 60000); // Update every minute
      
      // Handle page unload
      window.addEventListener('beforeunload', function() {
        clearInterval(durationInterval);
      });
    }
    
    // Update message count in chat activity
    function updateChatMessageCount() {
      if (!userEmail || !chatActivityId) return;
      
      let userData = JSON.parse(localStorage.getItem('intervuUserActivity_' + userEmail));
      
      if (!userData) return;
      
      const chat = userData.chats.find(c => c.id === chatActivityId);
      if (chat) {
        chat.messageCount++;
        localStorage.setItem('intervuUserActivity_' + userEmail, JSON.stringify(userData));
      }
    }

    // Chat history to maintain context
    let chatHistory = [
      {
        role: "system",
        content: "You are an AI interview assistant named InterVU. You help users prepare for job interviews, provide resume advice, and offer career guidance. Keep responses concise, helpful, and encouraging. Focus on practical advice that helps the user succeed in their job search and interviews."
      }
    ];

    // Event listeners
    sendButton.addEventListener('click', sendMessage);
    userInput.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        sendMessage();
      }
    });

    // Add click event to suggestions
    suggestions.forEach(suggestion => {
      suggestion.addEventListener('click', function() {
        userInput.value = this.textContent;
        sendMessage();
      });
    });

    // Function to send user message
    function sendMessage() {
      const message = userInput.value.trim();
      if (message === '') return;

      // Add user message to chat
      addMessage(message, 'user');
      
      // Add to chat history
      chatHistory.push({
        role: "user",
        content: message
      });
      
      // Clear input
      userInput.value = '';
      
      // Show typing indicator
      typingIndicator.style.display = 'block';
      
      // Disable send button while processing
      sendButton.disabled = true;
      
      // Track message for dashboard
      if (userEmail && chatActivityId) {
        updateChatMessageCount();
      }
      
      // Call API to get response
      getAIResponse();
    }

    // Function to add a message to the chat
    function addMessage(text, sender) {
      const messageDiv = document.createElement('div');
      messageDiv.classList.add('message', sender);
      
      const messageText = document.createElement('p');
      messageText.textContent = text;
      
      const timestamp = document.createElement('div');
      timestamp.classList.add('timestamp');
      timestamp.textContent = getCurrentTime();
      
      messageDiv.appendChild(messageText);
      messageDiv.appendChild(timestamp);
      
      chatMessages.appendChild(messageDiv);
      
      // Scroll to bottom
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // Function to get current time
    function getCurrentTime() {
      const now = new Date();
      let hours = now.getHours();
      let minutes = now.getMinutes();
      const ampm = hours >= 12 ? 'PM' : 'AM';
      
      hours = hours % 12;
      hours = hours ? hours : 12;
      minutes = minutes < 10 ? '0' + minutes : minutes;
      
      return `${hours}:${minutes} ${ampm}`;
    }

    // Function to get AI response using Together AI API
    async function getAIResponse() {
      try {
        // Check if API key is initialized
        if (!API_KEY) {
          console.warn("API key not initialized yet, trying to initialize...");
          initializeApiKey();
          
          // Wait a bit for initialization
          await new Promise(resolve => setTimeout(resolve, 500));
          
          // If still not initialized, fall back to mock response
          if (!API_KEY) {
            console.error("API key still not available, using mock response");
            simulateAIResponse(chatHistory[chatHistory.length - 1].content);
            return;
          }
        }
        
        console.log("Making API request to Together.ai...");
        
        // Using Together AI API with Mistral model
        const response = await fetch('https://api.together.xyz/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${API_KEY}`
          },
          body: JSON.stringify({
            model: "mistralai/Mistral-7B-Instruct-v0.2",
            messages: chatHistory,
            max_tokens: 800,
            temperature: 0.7
          })
        });

        if (!response.ok) {
          const errorText = await response.text();
          console.error(`API request failed: ${response.status} ${response.statusText}`, errorText);
          throw new Error(`API request failed: ${response.status} ${response.statusText}`);
        }

        const data = await response.json();
        console.log("API response received:", data);
        
        if (data.choices && data.choices[0] && data.choices[0].message) {
          // Add AI response to chat history
          const aiResponse = data.choices[0].message.content;
          chatHistory.push({
            role: "assistant",
            content: aiResponse
          });
          
          // Keep chat history manageable (limit to last 10 messages)
          if (chatHistory.length > 11) { // 1 system + 10 conversation turns
            chatHistory = [
              chatHistory[0], // Keep the system message
              ...chatHistory.slice(chatHistory.length - 10) // Keep the last 10 messages
            ];
          }
          
          // Add typing effect for more natural feel
          typingEffect(aiResponse);
        } else {
          console.error("Unexpected API response format:", data);
          // Hide typing indicator
          typingIndicator.style.display = 'none';
          
          // Add error message
          addMessage("I'm sorry, I couldn't process your request. Please try again.", 'bot');
          
          // Re-enable send button
          sendButton.disabled = false;
        }
        
      } catch (error) {
        console.error('Error:', error);
        
        // Hide typing indicator
        typingIndicator.style.display = 'none';
        
        // Add error message
        addMessage("I'm having trouble connecting right now. Please try again later.", 'bot');
        
        // Re-enable send button
        sendButton.disabled = false;
      }
    }
    
    // Function to create a typing effect for AI responses
    function typingEffect(text) {
      // Calculate a realistic typing delay based on message length
      const typingSpeed = Math.min(50, Math.max(20, 1000 / (text.length / 5)));
      
      // Hide typing indicator after a short delay
      setTimeout(() => {
        typingIndicator.style.display = 'none';
        
        // Create message container
        const messageDiv = document.createElement('div');
        messageDiv.classList.add('message', 'bot');
        
        const messageText = document.createElement('p');
        messageDiv.appendChild(messageText);
        
        const timestamp = document.createElement('div');
        timestamp.classList.add('timestamp');
        timestamp.textContent = getCurrentTime();
        messageDiv.appendChild(timestamp);
        
        chatMessages.appendChild(messageDiv);
        
        // Start with empty text
        let displayedText = '';
        let charIndex = 0;
        
        // Function to add one character at a time
        function addNextChar() {
          if (charIndex < text.length) {
            displayedText += text.charAt(charIndex);
            messageText.textContent = displayedText;
            charIndex++;
            
            // Scroll to bottom as text appears
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Schedule next character with variable timing for natural effect
            const variableDelay = typingSpeed * (0.5 + Math.random());
            setTimeout(addNextChar, variableDelay);
          } else {
            // Re-enable send button when typing is complete
            sendButton.disabled = false;
          }
        }
        
        // Start the typing effect
        addNextChar();
      }, 500);
    }

    // For demo purposes - replace with actual API call in production
    // This function simulates the AI response for testing without using the API
    function simulateAIResponse(userMessage) {
      // Sample responses based on user input
      const responses = {
        "tell me about yourself": "This is one of the most common interview questions. Start with a brief introduction about your professional background, highlight key achievements, then connect your experience to the job you're applying for. Keep it under 2 minutes and focus on relevant skills and experiences.",
        "common interview questions": "Some common interview questions include: 'Tell me about yourself', 'Why do you want to work here?', 'What are your strengths and weaknesses?', 'Where do you see yourself in 5 years?', and 'Tell me about a challenge you faced and how you overcame it.'",
        "resume tips": "For a strong resume: 1) Tailor it to each job application, 2) Start with a compelling summary, 3) Focus on achievements rather than duties, 4) Use action verbs, 5) Keep it concise (1-2 pages), and 6) Ensure it's error-free.",
        "salary negotiation": "When negotiating salary: 1) Research industry standards, 2) Consider the entire compensation package, 3) Let the employer make the first offer, 4) Express enthusiasm for the role, and 5) Be prepared to justify your request with your value and experience."
      };
      
      // Default response if no match is found
      let aiResponse = "I'm here to help with your interview preparation and career questions. Could you provide more details about what you'd like to know?";
      
      // Check for matching keywords in the user's message
      const lowerCaseMessage = userMessage.toLowerCase();
      for (const [keyword, response] of Object.entries(responses)) {
        if (lowerCaseMessage.includes(keyword)) {
          aiResponse = response;
          break;
        }
      }
      
      // Simulate typing delay
      setTimeout(() => {
        // Hide typing indicator
        typingIndicator.style.display = 'none';
        
        // Add AI response to chat
        addMessage(aiResponse, 'bot');
        
        // Re-enable send button
        sendButton.disabled = false;
      }, 1500);
    }

    // Uncomment this function and comment out the getAIResponse call in sendMessage
    // if you want to test without using the API
    /*
    function sendMessage() {
      const message = userInput.value.trim();
      if (message === '') return;

      // Add user message to chat
      addMessage(message, 'user');
      
      // Clear input
      userInput.value = '';
      
      // Show typing indicator
      typingIndicator.style.display = 'block';
      
      // Disable send button while processing
      sendButton.disabled = true;
      
      // Simulate AI response
      simulateAIResponse(message);
    }
    */
  </script>

</body>
</html>