<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>InterVU - Login</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #e4e8eb 100%);
      color: #333;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    nav.navbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #fff;
      padding: 1rem 2rem;
      box-shadow: 0 4px 10px rgba(0,0,0,0.06);
      user-select: none;
    }
    .logo {
      font-size: 1.8rem;
      font-weight: 600;
      color: #ff4d6d;
    }
    .nav-right a {
      margin-left: 1.5rem;
      font-weight: 500;
      color: #555;
      text-decoration: none;
      transition: color 0.3s ease;
    }
    .nav-right a:hover {
      color: #ff4d6d;
    }
    main {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 2rem;
    }
    .login-container {
      background: white;
      padding: 2.5rem 3rem;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
      max-width: 400px;
      width: 100%;
      text-align: center;
      animation: fadeInUp 0.6s ease forwards;
    }
    .login-container h2 {
      color: #ff4d6d;
      margin-bottom: 1.5rem;
      font-weight: 600;
    }
    .form-group {
      margin-bottom: 1.2rem;
      text-align: left;
    }
    label {
      display: block;
      text-align: left;
      margin-bottom: 0.3rem;
      font-weight: 600;
      color: #555;
      font-size: 0.95rem;
    }
    .input-group {
      position: relative;
    }
    .input-icon {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: #aaa;
    }
    input[type="email"],
    input[type="password"] {
      width: 100%;
      padding: 0.75rem 1rem 0.75rem 2.5rem;
      border: 1px solid #ddd;
      border-radius: 10px;
      font-size: 1rem;
      outline: none;
      transition: all 0.3s ease;
      box-sizing: border-box;
    }
    input[type="email"]:focus,
    input[type="password"]:focus {
      border-color: #ff4d6d;
      box-shadow: 0 0 0 3px rgba(255, 77, 109, 0.15);
    }
    .validation-icon {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
    }
    .validation-message {
      font-size: 0.8rem;
      color: #ff4d6d;
      margin-top: 0.3rem;
      min-height: 1rem;
    }
    .forgot-password {
      text-align: right;
      margin-bottom: 1.5rem;
    }
    .forgot-password a {
      color: #666;
      font-size: 0.85rem;
      text-decoration: none;
      transition: color 0.3s;
    }
    .forgot-password a:hover {
      color: #ff4d6d;
    }
    button {
      background-color: #ff4d6d;
      color: white;
      border: none;
      padding: 0.85rem 1.5rem;
      font-size: 1.1rem;
      border-radius: 10px;
      cursor: pointer;
      width: 100%;
      transition: all 0.3s ease;
      font-weight: 500;
      margin-top: 0.5rem;
      position: relative;
      overflow: hidden;
    }
    button:hover {
      background-color: #e63b5f;
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(230, 59, 95, 0.3);
    }
    button:active {
      transform: translateY(0);
    }
    button .spinner {
      display: none;
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
    }
    button.loading {
      color: transparent;
    }
    button.loading .spinner {
      display: block;
      color: white;
    }
    .divider {
      display: flex;
      align-items: center;
      margin: 1.5rem 0;
      color: #999;
      font-size: 0.9rem;
    }
    .divider::before, .divider::after {
      content: "";
      flex: 1;
      height: 1px;
      background: #eee;
    }
    .divider span {
      padding: 0 1rem;
    }
    .social-login {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    .social-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: #f8f9fa;
      border: 1px solid #eee;
      color: #555;
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .social-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.07);
    }
    .social-btn.google {
      color: #DB4437;
    }
    .social-btn.facebook {
      color: #4267B2;
    }
    .social-btn.linkedin {
      color: #0077B5;
    }
    .register-link {
      margin-top: 1.5rem;
      font-size: 0.95rem;
      color: #666;
    }
    .register-link a {
      color: #ff4d6d;
      font-weight: 600;
      text-decoration: none;
      margin-left: 0.3rem;
      transition: color 0.3s ease;
    }
    .register-link a:hover {
      color: #e63b5f;
    }
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(40px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .spinner {
      animation: spin 1s linear infinite;
    }
    @media (max-width: 450px) {
      .login-container {
        padding: 2rem 1.5rem;
      }
    }
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      background: white;
      color: #333;
      padding: 1rem 1.5rem;
      border-radius: 8px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.15);
      display: flex;
      align-items: flex-start;
      gap: 10px;
      z-index: 1000;
      transition: all 0.3s ease;
      opacity: 0;
      transform: translateY(-20px);
      max-width: 400px;
      min-width: 300px;
      word-wrap: break-word;
      cursor: pointer;
    }
    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }
    .toast.success {
      border-left: 4px solid #4CAF50;
    }
    .toast.error {
      border-left: 4px solid #f44336;
    }
    .toast.warning {
      border-left: 4px solid #ff9800;
    }
    .toast-icon {
      font-size: 1.2rem;
      margin-top: 3px;
    }
    .toast.success .toast-icon {
      color: #4CAF50;
    }
    .toast.error .toast-icon {
      color: #f44336;
    }
    .toast.warning .toast-icon {
      color: #ff9800;
    }
    .toast::after {
      content: "Ã—";
      position: absolute;
      top: 8px;
      right: 12px;
      font-size: 16px;
      color: #999;
      opacity: 0.7;
    }
    .toast:hover::after {
      opacity: 1;
    }
  </style>
</head>
<body>

  <nav class="navbar">
    <div class="logo">InterVU</div>
    <div class="nav-right">
      <a href="index.html">Home</a>
      <a href="login.html">Login</a>
      <a href="register.html">Register</a>
    </div>
  </nav>

  <main>
    <div class="login-container">
      <h2>Welcome Back</h2>
      <form id="loginForm" novalidate>
        <div class="form-group">
          <label for="email">Email Address</label>
          <div class="input-group">
            <i class="input-icon fas fa-envelope"></i>
            <input type="email" id="email" placeholder="you@example.com" required />
            <div class="validation-icon" id="emailValidationIcon"></div>
          </div>
          <div class="validation-message" id="emailValidationMessage"></div>
        </div>

        <div class="form-group">
          <label for="password">Password</label>
          <div class="input-group">
            <i class="input-icon fas fa-lock"></i>
            <input type="password" id="password" placeholder="Enter your password" required />
            <div class="validation-icon" id="passwordToggle">
              <i class="fas fa-eye-slash" style="cursor: pointer; color: #aaa;"></i>
            </div>
          </div>
        </div>

        <div class="forgot-password">
          <a href="#">Forgot password?</a>
        </div>

        <button type="submit" id="loginButton">
          Login
          <i class="spinner fas fa-circle-notch"></i>
        </button>
      </form>

      <!-- Social login section removed as requested -->

      <p class="register-link">
        Don't have an account?
        <a href="register.html">Register here</a>
      </p>
    </div>
  </main>

  <div id="toast" class="toast">
    <i class="toast-icon fas"></i>
    <span id="toastMessage"></span>
  </div>

  <!-- Import Supabase client -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <!-- Import our scripts in the correct order -->
  <script src="supabase.js"></script>
  <script src="database-service.js"></script>
  <script src="auth-service.js"></script>
  <script src="login.js"></script>
  
  <script>
    // Legacy script for backward compatibility
    const form = document.getElementById('loginForm');
    const loginButton = document.getElementById('loginButton');
    const passwordToggle = document.getElementById('passwordToggle');
    const passwordInput = document.getElementById('password');
    const toast = document.getElementById('toast');
    const toastMessage = document.getElementById('toastMessage');

    // Toggle password visibility
    passwordToggle.addEventListener('click', function() {
      const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
      passwordInput.setAttribute('type', type);
      
      // Toggle eye icon
      const icon = passwordToggle.querySelector('i');
      icon.classList.toggle('fa-eye');
      icon.classList.toggle('fa-eye-slash');
    });

    // Show toast notification
    function showToast(message, type = 'error', duration = 5000) {
      toast.className = 'toast show ' + type;
      toastMessage.textContent = message;
      
      const icon = toast.querySelector('.toast-icon');
      icon.className = 'toast-icon fas';
      
      if (type === 'success') {
        icon.classList.add('fa-check-circle');
      } else if (type === 'error') {
        icon.classList.add('fa-exclamation-circle');
      } else if (type === 'warning') {
        icon.classList.add('fa-exclamation-triangle');
      }
      
      // Clear any existing timeout
      if (window.toastTimeout) {
        clearTimeout(window.toastTimeout);
      }
      
      // Set new timeout
      window.toastTimeout = setTimeout(() => {
        toast.classList.remove('show');
      }, duration);
      
      // Add click to dismiss
      toast.onclick = function() {
        toast.classList.remove('show');
        if (window.toastTimeout) {
          clearTimeout(window.toastTimeout);
        }
      };
    }

    // List of common disposable email domains
    const disposableEmailDomains = [
      'tempmail.com', 'throwawaymail.com', 'mailinator.com', 'guerrillamail.com', 
      'yopmail.com', 'sharklasers.com', 'trashmail.com', 'temp-mail.org',
      'fakeinbox.com', 'getnada.com', 'mailnesia.com', 'tempr.email',
      'dispostable.com', '10minutemail.com', 'tempmail.net', 'spamgourmet.com',
      'maildrop.cc', 'harakirimail.com', 'mailcatch.com', 'anonbox.net',
      'tempinbox.com', 'discard.email', 'emailondeck.com', 'spambox.us',
      'grr.la', 'spam4.me', 'incognitomail.com', 'mintemail.com',
      'mohmal.com', 'mytemp.email', 'temp-mail.io', 'disposable-email.com',
      'mailforspam.com', 'burnermail.io', 'tempinbox.io', 'fakemail.net',
      'trash-mail.com', 'jetable.org', 'meltmail.com', 'wegwerfmail.de',
      'mailnull.com', 'emltmp.com', 'emailsendr.com', 'tmpmail.net',
      'instantemailaddress.com', 'emailfake.com', 'tempmailo.com', 'emailtemp.org'
    ];

    // List of common legitimate email domains
    const commonEmailDomains = [
      'gmail.com', 'yahoo.com', 'outlook.com', 'hotmail.com', 'aol.com',
      'icloud.com', 'protonmail.com', 'mail.com', 'zoho.com', 'yandex.com',
      'gmx.com', 'tutanota.com', 'live.com', 'msn.com', 'me.com',
      'fastmail.com', 'mailbox.org', 'posteo.de', 'pm.me', 'hey.com',
      'comcast.net', 'verizon.net', 'att.net', 'mail.ru', 'web.de',
      'cox.net', 'sbcglobal.net', 'rediffmail.com', 'libero.it', 'orange.fr'
    ];

    // Abstract API key for email verification
    const ABSTRACT_API_KEY = 'c9e7f2a0a2a04d0d9d3c7a9e9c9e7f2a'; // This is a placeholder API key
    
    // Enhanced email validation with Abstract API for real email verification
    async function validateEmail(email, checkExistence = true) {
      // Basic format check
      const basicFormatValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
      if (!basicFormatValid) {
        return { valid: false, message: 'Email format is invalid. Please include @ and domain.' };
      }
      
      // Extract username and domain
      const [username, domain] = email.split('@');
      const lowerDomain = domain.toLowerCase();
      
      // Check if it's a disposable email
      if (disposableEmailDomains.includes(lowerDomain)) {
        return { valid: false, message: 'Please use a permanent email address. Disposable emails are not allowed.' };
      }
      
      // Check for common typos in domain names
      const commonTypos = {
        'gmial.com': 'gmail.com',
        'gmal.com': 'gmail.com',
        'gamil.com': 'gmail.com',
        'gnail.com': 'gmail.com',
        'hotmial.com': 'hotmail.com',
        'hotmal.com': 'hotmail.com',
        'yaho.com': 'yahoo.com',
        'yhaoo.com': 'yahoo.com',
        'outlok.com': 'outlook.com',
        'outloo.com': 'outlook.com',
        'protonmal.com': 'protonmail.com',
        'protmail.com': 'protonmail.com'
      };
      
      if (commonTypos[lowerDomain]) {
        return { valid: false, message: `Did you mean ${username}@${commonTypos[lowerDomain]}?` };
      }
      
      // Advanced format validation
      const advancedFormatValid = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(email);
      
      if (!advancedFormatValid) {
        return { valid: false, message: 'Email format is invalid. Please check for special characters.' };
      }

      // Skip further checks if we're just doing basic validation
      if (!checkExistence) {
        return { valid: true, message: 'Email format is valid' };
      }
      
      // For this demo, we'll simulate the Abstract API response
      // In a real implementation, you would make an actual API call
      try {
        const verificationResult = await simulateAbstractAPIVerification(email);
        
        if (!verificationResult.is_valid_format.value || 
            !verificationResult.is_mx_found.value || 
            verificationResult.is_disposable_email.value) {
          
          let message = 'This email appears to be invalid.';
          
          if (!verificationResult.is_valid_format.value) {
            message = 'Email format is invalid.';
          } else if (!verificationResult.is_mx_found.value) {
            message = 'This email domain cannot receive emails.';
          } else if (verificationResult.is_disposable_email.value) {
            message = 'Please use a permanent email address. Disposable emails are not allowed.';
          } else if (verificationResult.is_role_email.value) {
            message = 'Please use a personal email address, not a role-based one (like info@ or support@).';
          }
          
          return { valid: false, message };
        }
        
        // Check for obviously fake or test emails
        if (isFakeOrTestEmail(username, lowerDomain)) {
          return { 
            valid: false, 
            message: 'This appears to be a test or system email. Please use your personal email address.'
          };
        }
        
        return { valid: true, message: 'Email verified successfully' };
      } catch (error) {
        console.error('Email verification error:', error);
        
        // Fallback to our basic checks if the API simulation fails
        return fallbackEmailValidation(email, username, lowerDomain);
      }
    }
    
    // Simulate Abstract API email verification
    // In a real implementation, this would be an actual API call
    async function simulateAbstractAPIVerification(email) {
      // Simulate network delay
      await new Promise(resolve => setTimeout(resolve, 800));
      
      const [username, domain] = email.split('@');
      const lowerDomain = domain.toLowerCase();
      
      // Check if domain exists by doing a DNS lookup
      let mxRecordsExist = true;
      try {
        const response = await fetch(`https://dns.google/resolve?name=${lowerDomain}&type=MX`);
        const data = await response.json();
        mxRecordsExist = !!(data.Answer && data.Answer.length > 0);
        
        if (!mxRecordsExist) {
          // Try checking for A records as fallback
          const aResponse = await fetch(`https://dns.google/resolve?name=${lowerDomain}&type=A`);
          const aData = await aResponse.json();
          mxRecordsExist = !!(aData.Answer && aData.Answer.length > 0);
        }
      } catch (error) {
        console.error('DNS check error:', error);
        // If DNS check fails, we'll assume the domain might exist
        mxRecordsExist = true;
      }
      
      // Determine if it's a role email
      const isRoleEmail = /^(admin|info|support|contact|help|sales|team|office|billing|service|mail|webmaster|postmaster|hostmaster|abuse)@/.test(email.toLowerCase());
      
      // Check for common fake patterns
      const isFakePattern = /^(test|fake|example|user\d+|demo|sample)@/.test(email.toLowerCase());
      
      // Check for disposable email domains
      const isDisposable = disposableEmailDomains.includes(lowerDomain);
      
      // Check for valid format
      const isValidFormat = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(email);
      
      // Simulate Abstract API response structure
      return {
        email: email,
        autocorrect: "",
        deliverability: mxRecordsExist ? "DELIVERABLE" : "UNDELIVERABLE",
        quality_score: isFakePattern ? 0.3 : isRoleEmail ? 0.5 : 0.9,
        is_valid_format: { value: isValidFormat, text: isValidFormat ? "TRUE" : "FALSE" },
        is_free_email: { value: commonEmailDomains.includes(lowerDomain), text: commonEmailDomains.includes(lowerDomain) ? "TRUE" : "FALSE" },
        is_disposable_email: { value: isDisposable, text: isDisposable ? "TRUE" : "FALSE" },
        is_role_email: { value: isRoleEmail, text: isRoleEmail ? "TRUE" : "FALSE" },
        is_catchall_email: { value: false, text: "FALSE" },
        is_mx_found: { value: mxRecordsExist, text: mxRecordsExist ? "TRUE" : "FALSE" },
        is_smtp_valid: { value: mxRecordsExist, text: mxRecordsExist ? "TRUE" : "FALSE" }
      };
    }
    
    // Check if email is likely fake or test
    function isFakeOrTestEmail(username, domain) {
      // Check for common test patterns in username
      const testPatterns = /^(test|fake|example|user\d+|admin|info|support|noreply|webmaster|postmaster|hostmaster|demo|sample)$/i;
      if (testPatterns.test(username)) {
        return true;
      }
      
      // Check for sequential or repeated patterns that are likely fake
      if (/^[a-z]{1,2}\d{4,}$/i.test(username) || // like ab1234
          /^[a-z]+\d{3,}$/i.test(username) ||     // like user123
          /(\d{3,}|[a-z]{3,})\1+/i.test(username) || // repeated patterns
          /^[a-z]{1,3}[0-9]{1,3}[a-z]{1,3}$/i.test(username)) { // like abc123def
        return true;
      }
      
      // For Gmail addresses, check if the username follows Gmail rules
      if (domain.toLowerCase() === 'gmail.com') {
        // Gmail ignores dots in username and doesn't allow certain characters
        const normalizedUsername = username.replace(/\./g, '').toLowerCase();
        
        // Gmail usernames must be between 6-30 characters
        if (normalizedUsername.length < 6 || normalizedUsername.length > 30) {
          return true;
        }
        
        // Gmail only allows letters, numbers, periods, and some special characters
        if (!/^[a-z0-9.]+$/.test(normalizedUsername)) {
          return true;
        }
      }
      
      return false;
    }
    
    // Fallback validation if API fails
    function fallbackEmailValidation(email, username, lowerDomain) {
      // For Gmail addresses, check if the username follows Gmail rules
      if (lowerDomain === 'gmail.com') {
        // Gmail ignores dots in username and doesn't allow certain characters
        const normalizedUsername = username.replace(/\./g, '').toLowerCase();
        
        // Gmail usernames must be between 6-30 characters
        if (normalizedUsername.length < 6 || normalizedUsername.length > 30) {
          return { valid: false, message: 'Gmail addresses must be between 6-30 characters (excluding dots).' };
        }
        
        // Gmail only allows letters, numbers, periods, and some special characters
        if (!/^[a-z0-9.]+$/.test(normalizedUsername)) {
          return { valid: false, message: 'Gmail addresses can only contain letters, numbers, and periods.' };
        }
        
        // Check for common fake Gmail patterns
        if (/test|fake|example|user\d+|admin|info|support|noreply/.test(normalizedUsername)) {
          return { valid: false, message: 'This appears to be a test or fake email. Please use your real Gmail address.' };
        }
      }
      
      // For Yahoo addresses
      if (lowerDomain === 'yahoo.com') {
        // Yahoo usernames must be between 4-32 characters
        if (username.length < 4 || username.length > 32) {
          return { valid: false, message: 'Yahoo addresses must be between 4-32 characters.' };
        }
        
        // Check for common fake Yahoo patterns
        if (/test|fake|example|user\d+|admin|info|support|noreply/.test(username.toLowerCase())) {
          return { valid: false, message: 'This appears to be a test or fake email. Please use your real Yahoo address.' };
        }
      }
      
      // For Outlook/Hotmail addresses
      if (['outlook.com', 'hotmail.com', 'live.com'].includes(lowerDomain)) {
        // Outlook usernames must be at least 1 character
        if (username.length < 1) {
          return { valid: false, message: 'Outlook/Hotmail addresses must have at least 1 character in the username.' };
        }
        
        // Check for common fake Outlook patterns
        if (/test|fake|example|user\d+|admin|info|support|noreply/.test(username.toLowerCase())) {
          return { valid: false, message: 'This appears to be a test or fake email. Please use your real Outlook/Hotmail address.' };
        }
      }
      
      // Check for obviously fake usernames across all domains
      if (/^(test|fake|example|user\d+|admin|info|support|noreply|webmaster|postmaster|hostmaster)$/.test(username.toLowerCase())) {
        return { valid: false, message: 'This appears to be a system or test email address. Please use your personal email.' };
      }
      
      // Check for sequential or repeated patterns that are likely fake
      if (/^[a-z]{1,2}\d{4,}$/i.test(username) || // like ab1234
          /^[a-z]+\d{3,}$/i.test(username) ||     // like user123
          /(\d{3,}|[a-z]{3,})\1+/i.test(username) || // repeated patterns
          /^[a-z]{1,3}[0-9]{1,3}[a-z]{1,3}$/i.test(username)) { // like abc123def
        return { valid: false, message: 'This email pattern appears to be automatically generated. Please use your real email.' };
      }
      
      // If it's a common known domain, we need to verify the email might exist
      if (commonEmailDomains.includes(lowerDomain)) {
        // Additional checks for common domains can be added here
        // For now, we've done the basic checks above
        return { valid: true, message: 'Email appears valid' };
      }
      
      return { valid: true, message: 'Email appears valid' };
    }

    // Real-time email validation
    const emailInput = document.getElementById('email');
    const emailValidationIcon = document.getElementById('emailValidationIcon');
    const emailValidationMessage = document.getElementById('emailValidationMessage');
    
    let emailValidationTimeout;
    
    emailInput.addEventListener('input', function() {
      const email = this.value.trim();
      
      // Clear previous timeout
      clearTimeout(emailValidationTimeout);
      
      if (!email) {
        emailValidationIcon.innerHTML = '';
        emailValidationMessage.textContent = '';
        return;
      }
      
      // Set a small delay to avoid validating on every keystroke
      emailValidationTimeout = setTimeout(async () => {
        // Use our enhanced validation function with basic checks only for real-time feedback
        // We'll do the full domain check on form submission
        const validation = await validateEmail(email, false);
        
        if (validation.valid) {
          // Valid email
          emailValidationIcon.innerHTML = '<i class="fas fa-check-circle" style="color: #4CAF50;"></i>';
          emailValidationMessage.textContent = '';
          
          // Add special styling for common email providers
          const domain = email.split('@')[1].toLowerCase();
          if (commonEmailDomains.includes(domain)) {
            emailValidationIcon.innerHTML = '<i class="fas fa-check-circle" style="color: #4CAF50;"></i>';
          }
        } else {
          // Invalid email
          emailValidationIcon.innerHTML = '<i class="fas fa-exclamation-circle" style="color: #ff4d6d;"></i>';
          emailValidationMessage.textContent = validation.message;
        }
      }, 300);
    });

    // Social login section removed as requested

    // Forgot password link
    document.querySelector('.forgot-password a').addEventListener('click', function(e) {
      e.preventDefault();
      showToast('Password reset functionality is not implemented in this demo', 'warning');
    });

    form.addEventListener('submit', async function (e) {
      e.preventDefault();

      const email = form.email.value.trim();
      const password = form.password.value;

      // Show loading state
      loginButton.classList.add('loading');

      if (!email) {
        showToast('Please enter your email address');
        loginButton.classList.remove('loading');
        form.email.focus();
        return;
      }

      // Always validate email with strict domain check
      const emailValidation = await validateEmail(email);
      if (!emailValidation.valid) {
        showToast(emailValidation.message);
        loginButton.classList.remove('loading');
        form.email.focus();
        return;
      }

      if (!password) {
        showToast('Please enter your password');
        loginButton.classList.remove('loading');
        form.password.focus();
        return;
      }

      // Simulate network delay
      setTimeout(() => {
        // Get users from localStorage
        const users = JSON.parse(localStorage.getItem('intervuUsers')) || [];

        // Find user by email
        const user = users.find(u => u.email.toLowerCase() === email.toLowerCase());

        if (!user) {
          showToast('No account found with this email. Please register first.');
          loginButton.classList.remove('loading');
          return;
        }

        // Check if account is verified
        if (!user.verified) {
          showToast('Your email address has not been verified. Please complete registration first.', 'warning');
          loginButton.classList.remove('loading');
          
          // Add option to go to registration page
          setTimeout(() => {
            if (confirm('Would you like to register again with this email?')) {
              window.location.href = 'register.html';
            }
          }, 1000);
          return;
        }

        if (user.password !== password) {
          showToast('Incorrect password. Please try again.');
          loginButton.classList.remove('loading');
          form.password.focus();
          return;
        }

        // Login successful
        showToast(`Welcome back, ${user.fullname}!`, 'success');
        
        // Save login session info
        localStorage.setItem('intervuCurrentUser', JSON.stringify(user));

        // Redirect after a short delay
        setTimeout(() => {
          window.location.href = 'index.html';
        }, 1500);
      }, 1000);
    });
  </script>

</body>
</html>
